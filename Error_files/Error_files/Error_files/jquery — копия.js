(function($){$.fn.lightBox=function(settings){function _initialize(){return _start(this,jQueryMatchedObj),!1}function _start(objClicked,jQueryMatchedObj){if($("embed, object, select").css({visibility:"hidden"}),_set_interface(),settings.imageArray.length=0,settings.activeImage=0,1==jQueryMatchedObj.length)settings.imageArray.push([objClicked.getAttribute("href"),objClicked.getAttribute("title")]);else for(var i=0;jQueryMatchedObj.length>i;i++)settings.imageArray.push([jQueryMatchedObj[i].getAttribute("href"),jQueryMatchedObj[i].getAttribute("title")]);for(;settings.imageArray[settings.activeImage][0]!=objClicked.getAttribute("href");)settings.activeImage++;_set_image_to_view()}function _set_interface(){$("body").append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-image-box"><div id="lightbox-container-image"><img id="lightbox-image"><div style="" id="lightbox-nav"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div><div id="lightbox-loading"><a href="#" id="lightbox-loading-link"><img src="'+settings.imageLoading+'"></a></div></div></div><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span><span id="lightbox-image-details-currentNumber"></span></div><div id="lightbox-secNav"><a href="#" id="lightbox-secNav-btnClose"><img src="'+settings.imageBtnClose+'"></a></div></div></div></div>');var arrPageSizes=___getPageSize();$("#jquery-overlay").css({backgroundColor:settings.overlayBgColor,opacity:settings.overlayOpacity,width:arrPageSizes[0],height:arrPageSizes[1]}).fadeIn();var arrPageScroll=___getPageScroll();$("#jquery-lightbox").css({top:arrPageScroll[1]+arrPageSizes[3]/10,left:arrPageScroll[0]}).show(),$("#jquery-overlay,#jquery-lightbox").click(function(){_finish()}),$("#lightbox-loading-link,#lightbox-secNav-btnClose").click(function(){return _finish(),!1}),$(window).resize(function(){var arrPageSizes=___getPageSize();$("#jquery-overlay").css({width:arrPageSizes[0],height:arrPageSizes[1]});var arrPageScroll=___getPageScroll();$("#jquery-lightbox").css({top:arrPageScroll[1]+arrPageSizes[3]/10,left:arrPageScroll[0]})})}function _set_image_to_view(){$("#lightbox-loading").show(),settings.fixedNavigation?$("#lightbox-image,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide():$("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide();var objImagePreloader=new Image;objImagePreloader.onload=function(){$("#lightbox-image").attr("src",settings.imageArray[settings.activeImage][0]),_resize_container_image_box(objImagePreloader.width,objImagePreloader.height),objImagePreloader.onload=function(){}},objImagePreloader.src=settings.imageArray[settings.activeImage][0]}function _resize_container_image_box(intImageWidth,intImageHeight){var intCurrentWidth=$("#lightbox-container-image-box").width(),intCurrentHeight=$("#lightbox-container-image-box").height();if(settings.maxWidth&&settings.maxHeight&&(intImageWidth>settings.maxWidth||intImageHeight>settings.maxHeight)){var scale=intImageWidth>intImageHeight?settings.maxWidth/intImageWidth:settings.maxHeight/intImageHeight;intImageWidth=0|intImageWidth*scale,intImageHeight=0|intImageHeight*scale}var intWidth=intImageWidth+2*settings.containerBorderSize,intHeight=intImageHeight+2*settings.containerBorderSize,intDiffW=intCurrentWidth-intWidth,intDiffH=intCurrentHeight-intHeight;$("#lightbox-container-image-box").animate({width:intWidth,height:intHeight},settings.containerResizeSpeed,function(){_show_image()}),0==intDiffW&&0==intDiffH&&($.browser.msie?___pause(250):___pause(100)),$("#lightbox-container-image-data-box").css({width:intImageWidth}),$("#lightbox-nav-btnPrev,#lightbox-nav-btnNext").css({height:intImageHeight+2*settings.containerBorderSize})}function _show_image(){$("#lightbox-loading").hide(),$("#lightbox-image").fadeIn(function(){_show_image_data(),_set_navigation()}),_preload_neighbor_images()}function _show_image_data(){$("#lightbox-container-image-data-box").slideDown("fast"),$("#lightbox-image-details-caption").hide(),settings.imageArray[settings.activeImage][1]&&$("#lightbox-image-details-caption").html(settings.imageArray[settings.activeImage][1]).show(),settings.imageArray.length>1&&$("#lightbox-image-details-currentNumber").html(settings.txtImage+" "+(settings.activeImage+1)+" "+settings.txtOf+" "+settings.imageArray.length).show()}function _set_navigation(){$("#lightbox-nav").show(),$("#lightbox-nav-btnPrev,#lightbox-nav-btnNext").css({background:"transparent url("+settings.imageBlank+") no-repeat"}),0!=settings.activeImage&&(settings.fixedNavigation?$("#lightbox-nav-btnPrev").css({background:"url("+settings.imageBtnPrev+") left 15% no-repeat"}).unbind().bind("click",function(){return settings.activeImage=settings.activeImage-1,_set_image_to_view(),!1}):$("#lightbox-nav-btnPrev").unbind().hover(function(){$(this).css({background:"url("+settings.imageBtnPrev+") left 15% no-repeat"})},function(){$(this).css({background:"transparent url("+settings.imageBlank+") no-repeat"})}).show().bind("click",function(){return settings.activeImage=settings.activeImage-1,_set_image_to_view(),!1})),settings.activeImage!=settings.imageArray.length-1&&(settings.fixedNavigation?$("#lightbox-nav-btnNext").css({background:"url("+settings.imageBtnNext+") right 15% no-repeat"}).unbind().bind("click",function(){return settings.activeImage=settings.activeImage+1,_set_image_to_view(),!1}):$("#lightbox-nav-btnNext").unbind().hover(function(){$(this).css({background:"url("+settings.imageBtnNext+") right 15% no-repeat"})},function(){$(this).css({background:"transparent url("+settings.imageBlank+") no-repeat"})}).show().bind("click",function(){return settings.activeImage=settings.activeImage+1,_set_image_to_view(),!1})),_enable_keyboard_navigation()}function _enable_keyboard_navigation(){$(document).keydown(function(objEvent){_keyboard_action(objEvent)})}function _disable_keyboard_navigation(){$(document).unbind()}function _keyboard_action(objEvent){null==objEvent?(keycode=event.keyCode,escapeKey=27):(keycode=objEvent.keyCode,escapeKey=objEvent.DOM_VK_ESCAPE),key=String.fromCharCode(keycode).toLowerCase(),(key==settings.keyToClose||"x"==key||keycode==escapeKey)&&_finish(),(key==settings.keyToPrev||37==keycode)&&0!=settings.activeImage&&(settings.activeImage=settings.activeImage-1,_set_image_to_view(),_disable_keyboard_navigation()),(key==settings.keyToNext||39==keycode)&&settings.activeImage!=settings.imageArray.length-1&&(settings.activeImage=settings.activeImage+1,_set_image_to_view(),_disable_keyboard_navigation())}function _preload_neighbor_images(){settings.imageArray.length-1>settings.activeImage&&(objNext=new Image,objNext.src=settings.imageArray[settings.activeImage+1][0]),settings.activeImage>0&&(objPrev=new Image,objPrev.src=settings.imageArray[settings.activeImage-1][0])}function _finish(){$("#jquery-lightbox").remove(),$("#jquery-overlay").fadeOut(function(){$("#jquery-overlay").remove()}),$("embed, object, select").css({visibility:"visible"})}function ___getPageSize(){var xScroll,yScroll;window.innerHeight&&window.scrollMaxY?(xScroll=window.innerWidth+window.scrollMaxX,yScroll=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(xScroll=document.body.scrollWidth,yScroll=document.body.scrollHeight):(xScroll=document.body.offsetWidth,yScroll=document.body.offsetHeight);var windowWidth,windowHeight;return self.innerHeight?(windowWidth=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,windowHeight=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(windowWidth=document.documentElement.clientWidth,windowHeight=document.documentElement.clientHeight):document.body&&(windowWidth=document.body.clientWidth,windowHeight=document.body.clientHeight),pageHeight=windowHeight>yScroll?windowHeight:yScroll,pageWidth=windowWidth>xScroll?xScroll:windowWidth,arrayPageSize=[pageWidth,pageHeight,windowWidth,windowHeight]}function ___getPageScroll(){var xScroll,yScroll;return self.pageYOffset?(yScroll=self.pageYOffset,xScroll=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(yScroll=document.documentElement.scrollTop,xScroll=document.documentElement.scrollLeft):document.body&&(yScroll=document.body.scrollTop,xScroll=document.body.scrollLeft),arrayPageScroll=[xScroll,yScroll]}function ___pause(ms){var date=new Date;curDate=null;do var curDate=new Date;while(ms>curDate-date)}settings=jQuery.extend({overlayBgColor:"#000",overlayOpacity:.8,fixedNavigation:!1,imageLoading:"images/lightbox-ico-loading.gif",imageBtnPrev:"images/lightbox-btn-prev.gif",imageBtnNext:"images/lightbox-btn-next.gif",imageBtnClose:"images/lightbox-btn-close.gif",imageBlank:"images/lightbox-blank.gif",containerBorderSize:10,containerResizeSpeed:400,txtImage:"Image",txtOf:"of",keyToClose:"c",keyToPrev:"p",keyToNext:"n",imageArray:[],activeImage:0,maxWidth:null,maxHeight:null},settings);var jQueryMatchedObj=this;return this.unbind("click").click(_initialize)}})(jQuery);